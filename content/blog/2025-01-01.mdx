---
title: Atualiza√ß√£o 1.0 - Menos √© mais
tags: [botbase, updates, feats]
description: Grande atualiza√ß√£o mudando drasticamente estruturas e melhorando performance
---
import icons from "@/icons";

Essa atualiza√ß√£o traz mudan√ßas radicais nas estruturas e na forma como elas s√£o constru√≠das. Um destaque especial para os Responders que ficaram melhores ainda. Como voc√™s puderam notar no t√≠tulo, essa atualiza√ß√£o traz a possibilidade de fazer muito mais, com menos. Voc√™s ver√£o!

Comando para executar a CLI

```bash
npx constatic@latest
```

## Biblioteca do discord

A biblioteca `discord.js` foi atualizada para a vers√£o mais recente. Atualmente 14.17.2

## ‚ñ∂Ô∏è Fun√ß√£o inicial

A fun√ß√£o que antes se chamava `bootstrapApp`, agora se chama apenas `bootstrap`. Essa fun√ß√£o √© respons√°vel por iniciar toda a nossa aplica√ß√£o, desde carregar **comandos**, **eventos**, **responders**, registrar dados na aplica√ß√£o e fazer login com o token do bot.

```ts title="src/index.ts"
import { bootstrapApp } from "#base"; // [!code --]
import { bootstrap } from "#base"; // [!code ++]

await bootstrapApp({ workdir: import.meta.dirname }); // [!code --]
await bootstrap({ meta: import.meta }); // [!code ++]
```

<Accordions>
    <Accordion title="Mas por que mudar o nome dessa fun√ß√£o?">
    N√£o √© apenas para encurtar o nome da fun√ß√£o, isso tem um prop√≥sito. Por√©m ficar√° para uma futura atualiza√ß√£o. Os mais entusiastas j√° podem come√ßar a especular.
    </Accordion>
</Accordions>

Vamos ver agora algumas op√ß√µes que foram removidas da fun√ß√£o `bootstrap`

```ts title="src/index.ts"
interface BootstrapOptions extends Partial<ClientOptions> {
    workdir: string; // [!code --]
    meta: ImportMeta; // [!code ++]
	commands?: { // [!code --]
		guilds?: string[]; // [!code --]
		defaultMemberPermissions?: PermissionResolvable[]; // [!code --]
        onError?: CommandErrorHandler; // [!code --]
	}, // [!code --]
	responders?: { // [!code --]
        onNotFound?(interaction: ResponderInteraction<ResponderType, CacheType>): void; // [!code --]
        onError?: ResponderErrorHandler; // [!code --]
	}, // [!code --]
    directories?: string[];
    loadLogs?: boolean;
    beforeLoad?(client: Client): void
    whenReady?(client: Client<true>): void;
}
```

Antes era poss√≠vel definir algumas fun√ß√µes para determinados contextos para os comandos e os responders nas op√ß√µes da fun√ß√£o `bootstrap`. Mas agora n√£o √© mais poss√≠vel.

## üü¶ Pasta discord

Essa pasta ainda funciona da mesma maneira, todas as estruturas que estiverem dentro dela, seja qual for a profundidade de pastas aninhadas, ser√£o carregadas antes da aplica√ß√£o iniciar.
Mas um pequeno detalhe foi adicionado. Agora existe um arquivo `index.ts` na pasta `discord`.

Neste arquivo √© feita a prepara√ß√£o das estrutras da base

```ts title="src/discord/index.ts"
import { setupCreators } from "#base";

export const { createCommand, createEvent, createResponder } = setupCreators();
```

Para aqueles que j√° usavam a base antes, j√° perceberam que n√£o usaremos mais as classes `Command`, `Event` e `Responder`. Elas foram substitu√≠das pelas fun√ß√µes `createCommand`, `createEvet` e `createResponder`.

<Accordions>
    <Accordion title="Ainda funcionam da mesma maneira, voc√™ s√≥ precisa alterar de classe para fun√ß√£o">
    <Tabs items={["Comando", "Evento", "Responder"]}>
        <Tab value="Comando">
         ```ts title="ping.ts"
            import { Command } from "#base"; // [!code --]
            import { createCommand } from "#base"; // [!code ++]
            import { ApplicationCommandType } from "discord.js";

            new Command({ // [!code --]
            createCommand({// [!code ++]
                name: "ping",
                description: "Replies with pong üèì",
                type: ApplicationCommandType.ChatInput,
                run(interaction){
                    // ...
                }
            });
            ```
        </Tab>
        <Tab value="Evento">
         ```ts title="ready.ts"
            import { Event } from "#base"; // [!code --]
            import { createEvent } from "#base"; // [!code ++]

            new Event({ // [!code --]
            createEvent({// [!code ++]
                name: "When bot ready",
                event: "ready",
                run(arg){
                    // ...
                }
            });
            ```
        </Tab>
        <Tab value="Responder">
         ```ts title="buttons.ts"
            import { Responder, ResponderType } from "#base"; // [!code --]
            import { createResponder, ResponderType } from "#base"; // [!code ++]
                

            new Responder({ // [!code --]
            createResponder({// [!code ++]
                customId: "auth/start", cache: "cached",
                type: ResponderType.Button // [!code --]
                types: [ResponderType.Button] // [!code ++]
                run(interaction){
                    // ...
                }
            });
            ```
            Vamos falar desse `types` j√° j√°.
        </Tab>
        </Tabs>
    </Accordion>
</Accordions>

Mais uma vez, isso n√£o √© por acaso, essa altera√ß√£o trar√° grandes recursos em futuras atualiza√ß√µes.

<Blockquote color="info" icon={icons.info}>
    Os snippets da base tamb√©m foram atualizados! Voc√™ ainda pode continuar usando `new.command`, `new.event` e `new.responder` para gerar um pequeno trecho de c√≥digo inicial para essas fun√ß√µes.
</Blockquote>

Lembra que algumas op√ß√µes foram removidas da fun√ß√£o `bootstrap`? Ent√£o, agora elas ser√£o definidas na fun√ß√£o `setupCreators`:

```ts
export const { createCommand, createEvent, createResponder } = setupCreators({
    commands: {
        // ...
    },
    responders: {
        // ...
    }
});
```

### Op√ß√µes de comandos

Defina quais ser√£o as permiss√µes padr√µes de todos os comandos, caso n√£o seja definida nenhuma com a op√ß√£o `defaultMemberPermissions` (√â o mesmo array de permiss√µes do comando).

```ts
/* ... */ setupCreators({
    commands: {
        defaultMemberPermissions: ["SendMessages", "Connect"]
    },
});
```
Dessa forma, ao criar um comando e n√£o definir nenhuma permiss√£o padr√£o de membro, o que voc√™ definiu na fun√ß√£o `setupCreators`, ser√° o padr√£o de todos os comandos.

Voc√™ pode definir v√°rios IDs de guildas que deseja registrar os comandos do seu bot com a op√ß√£o `guilds`.

```ts
/* ... */ setupCreators({
    commands: {
        guilds: [process.env.MAIN_GUILD_ID, "537817462272557057"]
    },
});
```
Assim, ao inv√©s de registrar os comandos globalmente na aplica√ß√£o, eles ser√£o registrados apenas nas guildas, cujo os ids foram passados para essa op√ß√£o.

Agora vamos ver algumas fun√ß√µes abaixo que voc√™ pode definir para comandos e responders (Elas funcionam da mesma forma para ambos).

| Fun√ß√£o | descri√ß√£o |
| - | ---------- |
| `middleware` | √â executada toda vez antes de cada comando/responder ser executado |
| `onError`, | √â executada quando ocorrer um erro na execu√ß√£o de um comando/responder |
| `onNotFound` | √â executada caso um comando/responder n√£o for encontrado para a intera√ß√£o |

Sobre a fun√ß√£o `onError`, voc√™ pode conferir [alguns exemplos de uso dela em uma postagem anterior](/blog/2024-12-04#%EF%B8%8F-bootstrapapp), basta adptar agora para a fun√ß√£o `setupCreators`.

Agora sobre as outras fun√ß√µes, um blog de dicas ser√° postado em breve.

## Responders

Os Responders s√£o com certeza um dos recursos favoritos do desenvolvedor desta base, o que mais recebe aten√ß√£o e melhorias ao longo do tempo. Vamos come√ßar vendo algumas remo√ß√µes:

```ts
export enum ResponderType {
    Button,
    Select // [!code --]
    StringSelect,
    UserSelect,
    RoleSelect,
    ChannelSelect,
    MentionableSelect,
    Row // [!code --]
    Modal,
    ModalComponent,
    All // [!code --]
}
```

O tipo `ResponderType.Select` servia para responder qualquer tipo de select menu, o `ResponderType.Row` respondia qualquer componente de mensagem e o `ResponderType.All` respondia todos. Mas e agora?

A propriedade `type` foi renomeada para `types` e agora voc√™ pode passar um array de `ResponderType` que deseja que este Responder responda.

```ts
import { createResponder, ResponderType } from "#base";

createResponder({
    customId: "context/action",
    types: [ResponderType.Button], cache: "cached",
    async run(interaction) {
        // ...     
    },
});
```
Voc√™ pode limitar quais tipos de select menu deseja responder:
```ts
createResponder({
    // ..
    types: [
        ResponderType.StringSelect,
        ResponderType.UserSelect,
    ],
    // ..
});
```

<Accordions>
    <Accordion title="Voc√™ j√° usou o ResponderType.All para responder literalmente todos os tipos?">
    Quando isso foi adicionado, era uma forma de poder responder a diversos tipos de intera√ß√µes com o mesmo customId ou mesmo padr√£o de customId, mas particularmente, √© bem improv√°vel que algu√©m tenha usado isso para responder a **literalmente** todos os tipos de intera√ß√µes, faz mais sentido escolher quais tipos voc√™ quer.
    </Accordion>
</Accordions>

Que tal responder apenas bot√µes e modais?
```ts
createResponder({
    // ..
    types: [
        ResponderType.Button,
        ResponderType.ModalComponent,
        ResponderType.Modal,
    ],
    // ..
});
```
S√£o mais de 200 combina√ß√µes poss√≠veis e maior controle. Um detalhe importante, essa pequena altera√ß√£o diminuiu o tempo m√©dio para encontrar o Responder de 500-400ms para 30-20ms

Alguns tipos foram removidos, mas diversas possibilidades foram adicionadas. Menos √© mais!

## ‚≠ê Extras

Adicionado um novo snippet para criar uma fun√ß√£o de menu interativo

Use `new.menu` e ser√° gerado um trecho de c√≥digo como este:

```ts
import { ButtonBuilder, ButtonStyle, type InteractionReplyOptions } from "discord.js";
import { createEmbed, createRow } from "@magicyan/discord";

export function menu<R>(): R {
    const embed = createEmbed({
        description: "Menu"
    });

    const row = createRow(
        new ButtonBuilder({
            customId: "menu/action",
            label: ">", 
            style: ButtonStyle.Success
        })
    );

    return ({
        flags,
        embeds: [embed],
        components: [row] 
    } satisfies InteractionReplyOptions) as R;
}
```

## Conclus√£o

Estes novos recursos da base est√£o em um estado experimental, pode haver bugs ou erros inesperados, caso encontre algum, reporte diretamente no discord [Zunder Community](http://discord.gg/tTu8dGN).

---

Novidades, atualiza√ß√µes, altera√ß√µes, dicas e muito mais ser√° postado neste blog! Se voc√™ quiser ser notificado sempre que uma nova postagem for publicada, entre no discord [Zunder Community](http://discord.gg/tTu8dGN) ou Siga [@rinckodev no twitter/x](https://x.com/rinckodev)
